name: Discord Webhook Commit Notifications

on:
  push:
    branches:
      - main

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Send commit information to Discord
        uses: actions/github-script@v6
        with:
          script: |
            const webhookUrl = process.env.DISCORD_WEBHOOK_URL;
            const commitMessage = github.event.head_commit.message;
            const commitId = github.sha.substring(0, 7);
            const commitsCount = github.event.commits.length;
            const repoName = github.repository.split('/')[1];

            const content = `
              **Avatar** comfrog559098
              **[${repoName}:main]** ${commitsCount} new commit${commitsCount > 1 ? 's' : ''}: [Repository Link](https://github.com/${github.repository})
              **Commit ID** ${commitId} [Commit Link](https://github.com/${github.repository}/commit/${commitId})
              ${commitMessage} - comfrog559098
            `;

            const response = await fetch(webhookUrl, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({ content }),
            });

            if (!response.ok) {
              throw new Error(`Error sending Discord message: ${response.statusText}`);
            }
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
